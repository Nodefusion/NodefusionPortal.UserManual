# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  # Node.js version
  NODE_VERSION: '20.x'
  BUILD_DIR: 'build'
  DEPLOY_BRANCH: 'gh-pages'
  GIT_USER: 'Azure Pipeline'
  GIT_EMAIL: 'nodefusion@nodefusion.com'

steps:
- checkout: self
  persistCredentials: true

- task: NodeTool@0
  inputs:
    versionSpec: '$(NODE_VERSION)'
  displayName: 'Install Node.js'

  -script: |
    git config --global user.name "${GH_NAME}"
    git config --global user.email "${GH_EMAIL}"

    git checkout -b main 

    npm install
    npm run build
    
    git commit -m "Deploy from Azure Pipeline: $(Build.BuildId)"
    git push
  displayName: 'Deploy to GitHub Pages'
  env:
    GH_TOKEN: $(GH_TOKEN)
